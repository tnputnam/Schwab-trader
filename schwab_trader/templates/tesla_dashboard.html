{% extends "base.html" %}
{% import "components.html" as components %}

{% block title %}Volume Analysis Dashboard{% endblock %}

{% block extra_css %}
<style>
    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* Tab Navigation */
    .nav-tabs {
        margin-bottom: 20px;
        border-bottom: 2px solid #dee2e6;
    }
    .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        padding: 10px 20px;
        margin-right: 10px;
        border-radius: 4px;
    }
    .nav-tabs .nav-link.active {
        color: #007bff;
        background-color: #f8f9fa;
        border-bottom: 2px solid #007bff;
    }
    .nav-tabs .nav-link:hover:not(.active) {
        color: #0056b3;
        background-color: #f8f9fa;
    }
    
    /* Common Panel Styles */
    .panel {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .metric-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        transition: transform 0.2s ease;
    }
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .metric-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
    }
    .metric-value {
        font-size: 18px;
        font-weight: bold;
    }
    .metric-value.positive {
        color: #28a745;
    }
    .metric-value.negative {
        color: #dc3545;
    }
    
    /* Analysis Controls */
    .analysis-controls {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .stock-selector,
    .market-condition-selector {
        flex: 1;
    }
    
    .stock-selector select,
    .market-condition-selector select {
        width: 100%;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background-color: white;
    }
    
    /* Market Stats */
    .market-stats {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
    }
    
    .market-stats p {
        margin: 5px 0;
    }
    
    /* Chart Container */
    .chart-container {
        height: 400px;
        margin-top: 20px;
    }
    
    /* Trading Controls */
    .trading-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    .button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .button:hover {
        background: #0056b3;
    }
    .button:disabled {
        background: #6c757d;
        cursor: not-allowed;
    }
    .button.stop {
        background: #dc3545;
    }
    .button.stop:hover {
        background: #c82333;
    }
    
    /* Settings */
    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    .setting-group {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
    }
    .setting-group h4 {
        margin-bottom: 10px;
        color: #495057;
    }
    .setting-item {
        margin-bottom: 10px;
    }
    .setting-item label {
        display: block;
        margin-bottom: 5px;
        color: #666;
    }
    .setting-item input {
        width: 100%;
        padding: 8px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
    }
    
    /* Status Indicators */
    .status {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .status.running {
        background-color: #d4edda;
        color: #155724;
    }
    .status.stopped {
        background-color: #f8d7da;
        color: #721c24;
    }
    .api-status {
        margin-bottom: 20px;
        padding: 10px;
        border-radius: 4px;
        background: #e9ecef;
    }
    .api-status.connected {
        background: #d4edda;
        color: #155724;
    }
    .api-status.error {
        background: #f8d7da;
        color: #721c24;
    }
    
    /* Trade List */
    .trade-list {
        max-height: 400px;
        overflow-y: auto;
    }
    .trade-item {
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
    }
    .trade-item:last-child {
        border-bottom: none;
    }
    .trade-buy {
        background-color: rgba(40, 167, 69, 0.1);
    }
    .trade-sell {
        background-color: rgba(220, 53, 69, 0.1);
    }
    
    /* News Items */
    .news-item {
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
        transition: background-color 0.2s ease;
    }
    .news-item:hover {
        background-color: #f8f9fa;
    }
    .news-item:last-child {
        border-bottom: none;
    }
    .news-title {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .news-source {
        font-size: 12px;
        color: #666;
    }
    .news-date {
        font-size: 12px;
        color: #666;
    }
    
    /* Loading and Error States */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0,0,0,.1);
        border-radius: 50%;
        border-top-color: #007bff;
        animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .error-message {
        color: #dc3545;
        margin-top: 10px;
        padding: 10px;
        background: #f8d7da;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}

    {% if not alpha_vantage_available %}
    <div class="alert alert-warning" role="alert">
        Alpha Vantage API is not configured. Please set the ALPHA_VANTAGE_API_KEY environment variable.
    </div>
    {% else %}
    <div class="stock-tabs">
        <ul class="nav nav-tabs" id="stockTabs" role="tablist">
            {% for symbol in stock_data.keys() %}
            <li class="nav-item">
                <a class="nav-link {% if loop.first %}active{% endif %}" 
                   id="{{ symbol }}-tab" 
                   data-bs-toggle="tab" 
                   href="#{{ symbol }}" 
                   role="tab">
                    {{ symbol }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="tab-content" id="stockTabsContent">
        {% for symbol, data in stock_data.items() %}
        <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
             id="{{ symbol }}" 
             role="tabpanel">
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total Days</div>
                    <div class="metric-value">{{ data|length }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Average Volume</div>
                    <div class="metric-value">{{ (data|sum(attribute='volume') / data|length)|int }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Current Price</div>
                    <div class="metric-value">{{ data[0].close|round(2) }}</div>
                </div>
            </div>

            <div class="container mt-4">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Volume Analysis</h4>
                                <div class="analysis-controls">
                                    <div class="stock-selector">
                                        <label for="stockSymbol">Stock:</label>
                                        <select id="stockSymbol" class="form-select">
                                            <option value="TSLA">Tesla (TSLA)</option>
                                            <option value="NVDA">NVIDIA (NVDA)</option>
                                            <option value="AMZN">Amazon (AMZN)</option>
                                            <option value="AAPL">Apple (AAPL)</option>
                                        </select>
                                    </div>
                                    <div class="market-condition-selector">
                                        <label for="marketCondition">Market Condition:</label>
                                        <select id="marketCondition" class="form-select">
                                            <option value="bullish">Bullish Market (Apr 2020 - Mar 2021)</option>
                                            <option value="bearish">Bearish Market (Jan 2022 - Dec 2022)</option>
                                            <option value="neutral">Neutral Market (Jul 2021 - Jun 2022)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="marketConditionInfo" class="market-stats"></div>
                                <div class="chart-container">
                                    <canvas id="volumeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h3>Price vs Volume</h3>
                </div>
                <div class="chart-container">
                    <canvas id="{{ symbol }}-price-volume-chart"></canvas>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/tesla_dashboard.js') }}"></script>
{% endblock %} 